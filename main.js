var u=Object.defineProperty;var m=Object.getOwnPropertyDescriptor;var w=Object.getOwnPropertyNames;var v=Object.prototype.hasOwnProperty;var f=(r,s)=>{for(var e in s)u(r,e,{get:s[e],enumerable:!0})},N=(r,s,e,t)=>{if(s&&typeof s=="object"||typeof s=="function")for(let i of w(s))!v.call(r,i)&&i!==e&&u(r,i,{get:()=>s[i],enumerable:!(t=m(s,i))||t.enumerable});return r};var D=r=>N(u({},"__esModule",{value:!0}),r);var k={};f(k,{default:()=>g});module.exports=D(k);var n=require("obsidian"),c="obsidian-daily-interview-view",C={openRouterApiKey:"",model:"anthropic/claude-opus-4.5",readMonthlyNote:!0,readWeeklyNote:!0,readDailyNote:!0,previousDailyNotesCount:0,customPrompt:"",monthlyNoteFormat:"YYYY-MM",weeklyNoteFormat:"YYYY-[W]WW",dailyNoteFormat:"YYYY-MM-DD",monthlyNoteFolder:"",weeklyNoteFolder:"",dailyNoteFolder:"",interviewFolder:"Interviews"},F=["anthropic/claude-opus-4.5","anthropic/claude-sonnet-4.5","openai/gpt-5.1","openai/gpt-4o","google/gemini-2.5-pro-preview","google/gemini-2.5-flash","x-ai/grok-4","deepseek/deepseek-chat","anthropic/claude-sonnet-4","meta-llama/llama-3.3-70b-instruct","qwen/qwen-2.5-72b-instruct","mistralai/mistral-large-2"],g=class extends n.Plugin{async onload(){await this.loadSettings(),this.registerView(c,s=>new p(s,this)),this.addRibbonIcon("message-circle","Daily Interview",()=>{this.activateView()}),this.addCommand({id:"start-daily-interview",name:"Start Daily Interview",callback:()=>{this.activateView()}}),this.addSettingTab(new y(this.app,this))}onunload(){this.app.workspace.detachLeavesOfType(c)}async activateView(){let{workspace:s}=this.app,e=null,t=s.getLeavesOfType(c);t.length>0?e=t[0]:(e=s.getRightLeaf(!1),e&&await e.setViewState({type:c,active:!0})),e&&s.revealLeaf(e)}async loadSettings(){this.settings=Object.assign({},C,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async gatherContext(){let s=[],e=(0,n.moment)();if(this.settings.readMonthlyNote){let t=await this.getNoteContent(this.settings.monthlyNoteFolder,e.format(this.settings.monthlyNoteFormat));t&&s.push(`## Monthly Note (${e.format(this.settings.monthlyNoteFormat)})
${t}`)}if(this.settings.readWeeklyNote){let t=await this.getNoteContent(this.settings.weeklyNoteFolder,e.format(this.settings.weeklyNoteFormat));t&&s.push(`## Weekly Note (${e.format(this.settings.weeklyNoteFormat)})
${t}`)}if(this.settings.readDailyNote){let t=await this.getNoteContent(this.settings.dailyNoteFolder,e.format(this.settings.dailyNoteFormat));t&&s.push(`## Daily Note (${e.format(this.settings.dailyNoteFormat)})
${t}`)}if(this.settings.previousDailyNotesCount>0){let t=[];for(let i=1;i<=this.settings.previousDailyNotesCount;i++){let a=(0,n.moment)().subtract(i,"days"),o=await this.getNoteContent(this.settings.dailyNoteFolder,a.format(this.settings.dailyNoteFormat));o&&t.push(`### ${a.format("dddd, MMMM D, YYYY")} (${a.format(this.settings.dailyNoteFormat)})
${o}`)}t.length>0&&s.push(`## Previous Daily Notes

${t.join(`

---

`)}`)}return s.join(`

---

`)}async getNoteContent(s,e){let t=s?`${s}/${e}.md`:`${e}.md`,i=this.app.vault.getAbstractFileByPath(t);return i instanceof n.TFile?await this.app.vault.read(i):null}async saveInterview(s){let e=(0,n.moment)(),t=e.format("YYYY-MM-DD_HHmmss"),i=this.settings.interviewFolder,a=`Interview_${t}.md`,o=i?`${i}/${a}`:a;i&&(this.app.vault.getAbstractFileByPath(i)||await this.app.vault.createFolder(i));let l=`# Daily Interview - ${e.format("MMMM D, YYYY h:mm A")}

`;for(let h of s)h.role==="user"?l+=`**You:** ${h.content}

`:h.role==="assistant"&&(l+=`**Interviewer:** ${h.content}

`);return await this.app.vault.create(o,l),o}async appendToDailyNote(s,e){let t=(0,n.moment)(),i=this.settings.dailyNoteFolder?`${this.settings.dailyNoteFolder}/${t.format(this.settings.dailyNoteFormat)}.md`:`${t.format(this.settings.dailyNoteFormat)}.md`,a=this.app.vault.getAbstractFileByPath(i);if(a instanceof n.TFile){let o=await this.app.vault.read(a),l=`

---

## Evening Reflection

${s}

[[${e}|Full Interview]]`;await this.app.vault.modify(a,o+l),new n.Notice("Interview summary added to daily note!")}else new n.Notice("Could not find daily note to append summary.")}},p=class extends n.ItemView{constructor(e,t){super(e);this.messages=[];this.isLoading=!1;this.context="";this.interviewStarted=!1;this.plugin=t}getViewType(){return c}getDisplayText(){return"Daily Interview"}getIcon(){return"message-circle"}async onOpen(){let e=this.containerEl.children[1];e.empty(),e.addClass("interview-view-container");let t=e.createDiv({cls:"interview-header"});t.createEl("h4",{text:"Daily Interview"});let i=t.createEl("button",{text:"New Interview",cls:"interview-start-btn"});i.onclick=()=>this.startNewInterview(),this.chatContainer=e.createDiv({cls:"interview-chat-container"});let a=e.createDiv({cls:"interview-input-container"});this.inputEl=a.createEl("textarea",{placeholder:"Type your response..."});let o=a.createDiv({cls:"interview-button-row"}),l=o.createEl("button",{text:"Send",cls:"interview-send-btn"});l.onclick=()=>this.sendMessage();let h=o.createEl("button",{text:"End & Save",cls:"interview-end-btn"});h.onclick=()=>this.endInterview(),this.inputEl.addEventListener("keydown",d=>{d.key==="Enter"&&!d.shiftKey&&(d.preventDefault(),this.sendMessage())}),this.showWelcome()}showWelcome(){this.chatContainer.empty();let e=this.chatContainer.createDiv({cls:"interview-welcome"});e.createEl("p",{text:"Click 'New Interview' to start your daily reflection."}),e.createEl("p",{text:"The AI will read your daily, weekly, and monthly notes to personalize the conversation.",cls:"interview-welcome-sub"})}async startNewInterview(){if(!this.plugin.settings.openRouterApiKey){new n.Notice("Please set your OpenRouter API key in settings.");return}this.messages=[],this.chatContainer.empty(),this.interviewStarted=!0,this.context=await this.plugin.gatherContext();let e=this.buildSystemPrompt();this.messages.push({role:"system",content:e}),await this.getAIResponse()}buildSystemPrompt(){let e=(0,n.moment)(),i=`You are a thoughtful and empathetic interviewer helping someone reflect on their day. Your goal is to help them process their experiences, celebrate wins, acknowledge challenges, and identify insights.

${`Current date: ${e.format("dddd, MMMM D, YYYY")} at ${e.format("h:mm A")}`}

Be conversational, warm, and genuinely curious. Ask follow-up questions based on their responses. Keep your responses concise but meaningful.

The interview should cover:
1. How they're feeling right now
2. What went well today
3. What challenges they faced
4. What they learned or would do differently
5. What they're looking forward to

After 5-7 exchanges, naturally wrap up the conversation and provide a brief summary of the key points discussed.`;return this.plugin.settings.customPrompt&&(i+=`

Additional guidance: ${this.plugin.settings.customPrompt}`),this.context&&(i+=`

---

Here is context from their notes to inform your questions:

${this.context}`,i+=`

---

IMPORTANT: Start the conversation by briefly recapping what you noticed from their notes that seems relevant or interesting - mention specific things like goals, tasks, events, or themes you observed. Then use this context to ask your opening question. This shows you've read their notes and helps focus the conversation on what matters to them today.`),i}async sendMessage(){if(!this.interviewStarted){new n.Notice("Click 'New Interview' to start.");return}let e=this.inputEl.value.trim();!e||this.isLoading||(this.inputEl.value="",this.addMessageToChat("user",e),this.messages.push({role:"user",content:e}),await this.getAIResponse())}async getAIResponse(){this.isLoading=!0;let e=this.chatContainer.createDiv({cls:"loading-message"});e.textContent="Thinking...",this.chatContainer.scrollTop=this.chatContainer.scrollHeight;try{let a=(await(0,n.requestUrl)({url:"https://openrouter.ai/api/v1/chat/completions",method:"POST",headers:{Authorization:`Bearer ${this.plugin.settings.openRouterApiKey}`,"Content-Type":"application/json","HTTP-Referer":"https://obsidian.md","X-Title":"Obsidian Daily Interviewer"},body:JSON.stringify({model:this.plugin.settings.model,messages:this.messages})})).json.choices[0].message.content;e.remove(),this.addMessageToChat("assistant",a),this.messages.push({role:"assistant",content:a})}catch(t){e.remove(),console.error("OpenRouter API error:",t),new n.Notice("Error communicating with AI. Check your API key and try again.")}this.isLoading=!1}addMessageToChat(e,t){let i=this.chatContainer.createDiv({cls:`interview-message ${e}-message`}),a=e==="user"?"You":"Interviewer";i.createEl("strong",{text:a,cls:"message-label"});let o=i.createEl("div",{cls:"message-content"});o.textContent=t,this.chatContainer.scrollTop=this.chatContainer.scrollHeight}async endInterview(){if(this.messages.length<2){new n.Notice("No interview to save.");return}let e=this.chatContainer.createDiv({cls:"loading-message"});e.textContent="Saving interview...",this.chatContainer.scrollTop=this.chatContainer.scrollHeight;let t=[...this.messages,{role:"user",content:"Please provide a brief 2-3 sentence summary of our conversation, highlighting the key themes and insights."}];try{let o=(await(0,n.requestUrl)({url:"https://openrouter.ai/api/v1/chat/completions",method:"POST",headers:{Authorization:`Bearer ${this.plugin.settings.openRouterApiKey}`,"Content-Type":"application/json","HTTP-Referer":"https://obsidian.md","X-Title":"Obsidian Daily Interviewer"},body:JSON.stringify({model:this.plugin.settings.model,messages:t})})).json.choices[0].message.content,l=await this.plugin.saveInterview(this.messages);await this.plugin.appendToDailyNote(o,l.replace(".md","")),e.remove(),new n.Notice("Interview saved successfully!"),this.interviewStarted=!1,this.messages=[],this.showWelcome()}catch(i){e.remove(),console.error("Error saving interview:",i),new n.Notice("Error saving interview. Please try again.")}}async onClose(){}},y=class extends n.PluginSettingTab{constructor(s,e){super(s,e),this.plugin=e}display(){let{containerEl:s}=this;s.empty(),s.createEl("h2",{text:"Obsidian Daily Interviewer Settings"}),s.createEl("h3",{text:"OpenRouter Configuration"}),new n.Setting(s).setName("OpenRouter API Key").setDesc("Your OpenRouter API key for AI conversations").addText(e=>e.setPlaceholder("sk-or-...").setValue(this.plugin.settings.openRouterApiKey).onChange(async t=>{this.plugin.settings.openRouterApiKey=t,await this.plugin.saveSettings()})),new n.Setting(s).setName("Model").setDesc("Select the AI model to use for interviews").addDropdown(e=>{F.forEach(t=>{e.addOption(t,t)}),e.setValue(this.plugin.settings.model),e.onChange(async t=>{this.plugin.settings.model=t,await this.plugin.saveSettings()})}),s.createEl("h3",{text:"Note Sources"}),new n.Setting(s).setName("Read Monthly Note").setDesc("Include your monthly note as context for the interview").addToggle(e=>e.setValue(this.plugin.settings.readMonthlyNote).onChange(async t=>{this.plugin.settings.readMonthlyNote=t,await this.plugin.saveSettings()})),new n.Setting(s).setName("Monthly Note Folder").setDesc("Folder where monthly notes are stored (leave empty for vault root)").addText(e=>e.setPlaceholder("Monthly").setValue(this.plugin.settings.monthlyNoteFolder).onChange(async t=>{this.plugin.settings.monthlyNoteFolder=t,await this.plugin.saveSettings()})),new n.Setting(s).setName("Monthly Note Format").setDesc("Date format for monthly notes (Moment.js format)").addText(e=>e.setPlaceholder("YYYY-MM").setValue(this.plugin.settings.monthlyNoteFormat).onChange(async t=>{this.plugin.settings.monthlyNoteFormat=t,await this.plugin.saveSettings()})),new n.Setting(s).setName("Read Weekly Note").setDesc("Include your weekly note as context for the interview").addToggle(e=>e.setValue(this.plugin.settings.readWeeklyNote).onChange(async t=>{this.plugin.settings.readWeeklyNote=t,await this.plugin.saveSettings()})),new n.Setting(s).setName("Weekly Note Folder").setDesc("Folder where weekly notes are stored (leave empty for vault root)").addText(e=>e.setPlaceholder("Weekly").setValue(this.plugin.settings.weeklyNoteFolder).onChange(async t=>{this.plugin.settings.weeklyNoteFolder=t,await this.plugin.saveSettings()})),new n.Setting(s).setName("Weekly Note Format").setDesc("Date format for weekly notes (Moment.js format)").addText(e=>e.setPlaceholder("YYYY-[W]WW").setValue(this.plugin.settings.weeklyNoteFormat).onChange(async t=>{this.plugin.settings.weeklyNoteFormat=t,await this.plugin.saveSettings()})),new n.Setting(s).setName("Read Daily Note").setDesc("Include your daily note as context for the interview").addToggle(e=>e.setValue(this.plugin.settings.readDailyNote).onChange(async t=>{this.plugin.settings.readDailyNote=t,await this.plugin.saveSettings()})),new n.Setting(s).setName("Daily Note Folder").setDesc("Folder where daily notes are stored (leave empty for vault root)").addText(e=>e.setPlaceholder("Daily").setValue(this.plugin.settings.dailyNoteFolder).onChange(async t=>{this.plugin.settings.dailyNoteFolder=t,await this.plugin.saveSettings()})),new n.Setting(s).setName("Daily Note Format").setDesc("Date format for daily notes (Moment.js format)").addText(e=>e.setPlaceholder("YYYY-MM-DD").setValue(this.plugin.settings.dailyNoteFormat).onChange(async t=>{this.plugin.settings.dailyNoteFormat=t,await this.plugin.saveSettings()})),new n.Setting(s).setName("Previous Daily Notes").setDesc("Number of previous daily notes to include as context (0 to disable)").addSlider(e=>e.setLimits(0,14,1).setValue(this.plugin.settings.previousDailyNotesCount).setDynamicTooltip().onChange(async t=>{this.plugin.settings.previousDailyNotesCount=t,await this.plugin.saveSettings()})),s.createEl("h3",{text:"Interview Settings"}),new n.Setting(s).setName("Interview Save Folder").setDesc("Folder where interview transcripts will be saved").addText(e=>e.setPlaceholder("Interviews").setValue(this.plugin.settings.interviewFolder).onChange(async t=>{this.plugin.settings.interviewFolder=t,await this.plugin.saveSettings()})),new n.Setting(s).setName("Custom Prompt").setDesc("Additional instructions for the interviewer (optional)").addTextArea(e=>e.setPlaceholder("E.g., Focus on work-life balance, ask about creative projects, etc.").setValue(this.plugin.settings.customPrompt).onChange(async t=>{this.plugin.settings.customPrompt=t,await this.plugin.saveSettings()}))}};
